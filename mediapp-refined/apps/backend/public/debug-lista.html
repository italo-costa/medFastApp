<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üîç Debug Lista M√©dicos</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 2rem; }
        .debug-info { background: #f0f8ff; padding: 1rem; margin: 1rem 0; border-radius: 0.5rem; }
        .error { background: #ffe6e6; color: #d00; }
        .success { background: #e6ffe6; color: #090; }
        button { background: #007bff; color: white; padding: 0.5rem 1rem; border: none; border-radius: 0.25rem; cursor: pointer; margin: 0.25rem; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>üîç Debug - Lista de M√©dicos</h1>
    
    <div class="debug-info">
        <h3>Status da API</h3>
        <div id="apiStatus">Verificando...</div>
    </div>
    
    <div class="debug-info">
        <h3>Teste dos Bot√µes</h3>
        <div id="buttonsTest">Carregando...</div>
    </div>
    
    <div class="debug-info">
        <h3>Console de Debug</h3>
        <div id="debugConsole"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const console = document.getElementById('debugConsole');
            const timestamp = new Date().toLocaleTimeString();
            console.innerHTML += `<div class="${type}">[${timestamp}] ${message}</div>`;
            console.scrollTop = console.scrollHeight;
        }

        async function checkAPI() {
            try {
                log('üîÑ Verificando API...');
                const response = await fetch('/api/medicos');
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('apiStatus').innerHTML = `
                        <div class="success">‚úÖ API funcionando - ${data.data.length} m√©dicos</div>
                    `;
                    log(`‚úÖ API OK - ${data.data.length} m√©dicos encontrados`, 'success');
                    return data.data;
                } else {
                    throw new Error(data.message);
                }
            } catch (error) {
                document.getElementById('apiStatus').innerHTML = `
                    <div class="error">‚ùå Erro: ${error.message}</div>
                `;
                log(`‚ùå Erro na API: ${error.message}`, 'error');
                return [];
            }
        }

        function createTestButtons(doctors) {
            if (doctors.length === 0) {
                document.getElementById('buttonsTest').innerHTML = '<div class="error">Nenhum m√©dico dispon√≠vel para teste</div>';
                return;
            }

            const testDoctor = doctors[0];
            log(`üß™ Criando bot√£o de teste para: ${testDoctor.nome}`);
            
            document.getElementById('buttonsTest').innerHTML = `
                <p><strong>M√©dico de teste:</strong> ${testDoctor.nome}</p>
                <p><strong>ID:</strong> ${testDoctor.id}</p>
                <button onclick="testEditFunction('${testDoctor.id}', '${testDoctor.nome}')">
                    üîß Testar Fun√ß√£o editDoctor
                </button>
                <button onclick="testDirectLink('${testDoctor.id}')">
                    üîó Testar Link Direto
                </button>
                <button onclick="openListPage()">
                    üìã Abrir Lista Original
                </button>
            `;
        }

        // Simular a fun√ß√£o editDoctor exatamente como na lista-medicos.html
        function testEditFunction(doctorId, doctorName) {
            log(`üîß Testando editDoctor com ID: ${doctorId}`);
            
            if (!doctorId) {
                log('‚ùå ID do m√©dico n√£o fornecido', 'error');
                alert('Erro: ID do m√©dico n√£o encontrado');
                return;
            }
            
            log('üîÑ Redirecionando para edi√ß√£o...');
            const url = `/editar-medico.html?id=${doctorId}`;
            log(`üåê URL de destino: ${url}`);
            
            // Confirmar antes de redirecionar
            if (confirm(`Redirecionar para edi√ß√£o de ${doctorName}?\\nURL: ${url}`)) {
                log('‚úÖ Redirecionando...', 'success');
                window.location.href = url;
            } else {
                log('‚èπÔ∏è Redirecionamento cancelado pelo usu√°rio');
            }
        }

        function testDirectLink(doctorId) {
            const url = `/editar-medico.html?id=${doctorId}`;
            log(`üîó Abrindo link direto: ${url}`);
            window.open(url, '_blank');
        }

        function openListPage() {
            log('üìã Abrindo p√°gina de lista original');
            window.open('/lista-medicos.html', '_blank');
        }

        // Inicializar quando carregar
        window.addEventListener('load', async function() {
            log('üöÄ P√°gina de debug carregada');
            const doctors = await checkAPI();
            createTestButtons(doctors);
            log('‚úÖ Debug completo');
        });
    </script>
</body>
</html>