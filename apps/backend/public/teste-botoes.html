<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üî¨ Teste Real dos Bot√µes MediApp</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 2rem; 
            background: #f5f5f5;
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section { 
            background: white; 
            padding: 1.5rem; 
            margin: 1rem 0; 
            border-radius: 0.5rem; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button { 
            background: #4299e1; 
            color: white; 
            padding: 0.75rem 1.5rem; 
            border: none; 
            border-radius: 0.5rem; 
            cursor: pointer; 
            margin: 0.5rem;
            font-size: 1rem;
        }
        .test-button:hover { 
            background: #3182ce; 
        }
        .test-result { 
            background: #f7fafc; 
            padding: 1rem; 
            margin-top: 1rem; 
            border-radius: 0.5rem; 
            border-left: 4px solid #4299e1;
        }
        .loading { 
            color: #666; 
        }
        .success { 
            color: #38a169; 
        }
        .error { 
            color: #e53e3e; 
        }
        iframe {
            width: 100%;
            height: 400px;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <h1>üî¨ Teste Real dos Bot√µes MediApp</h1>
    <p>Este teste verifica se os bot√µes "Editar" na lista de m√©dicos est√£o funcionando corretamente.</p>

    <div class="test-section">
        <h3>üìã 1. Carregamento da Lista de M√©dicos</h3>
        <button class="test-button" onclick="loadDoctorsList()">Carregar Lista de M√©dicos</button>
        <div id="doctorsListResult" class="test-result" style="display: none;">
            <div class="loading">Carregando...</div>
        </div>
    </div>

    <div class="test-section">
        <h3>üîß 2. Teste de Redirecionamento dos Bot√µes</h3>
        <p>Os bot√µes abaixo simulam exatamente o que acontece quando voc√™ clica em "Editar" na lista:</p>
        <div id="testButtons" style="display: none;">
            <!-- Bot√µes ser√£o inseridos aqui -->
        </div>
    </div>

    <div class="test-section">
        <h3>üåê 3. Iframe de Teste</h3>
        <p>Visualize a p√°gina carregada diretamente aqui:</p>
        <iframe id="testFrame" src="about:blank" style="display: none;"></iframe>
    </div>

    <script>
        let doctors = [];

        async function loadDoctorsList() {
            const resultDiv = document.getElementById('doctorsListResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<div class="loading">üîÑ Carregando lista de m√©dicos...</div>';

            try {
                const response = await fetch('/api/medicos');
                const data = await response.json();

                if (data.success && data.data) {
                    doctors = data.data;
                    
                    resultDiv.innerHTML = `
                        <div class="success">
                            ‚úÖ Lista carregada com sucesso!<br>
                            üìä Total de m√©dicos: ${doctors.length}
                        </div>
                    `;

                    // Criar bot√µes de teste
                    createTestButtons();
                } else {
                    throw new Error(data.message || 'Erro desconhecido');
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="error">
                        ‚ùå Erro ao carregar lista: ${error.message}
                    </div>
                `;
            }
        }

        function createTestButtons() {
            const buttonsDiv = document.getElementById('testButtons');
            buttonsDiv.style.display = 'block';
            
            // Pegar os primeiros 3 m√©dicos para teste
            const testDoctors = doctors.slice(0, 3);
            
            buttonsDiv.innerHTML = `
                <p>Clique nos bot√µes abaixo para testar o redirecionamento:</p>
                ${testDoctors.map(doctor => `
                    <div style="margin: 1rem 0; padding: 1rem; background: #f7fafc; border-radius: 0.5rem;">
                        <strong>${doctor.nome}</strong> - ${doctor.especialidade}<br>
                        <small>ID: ${doctor.id}</small><br>
                        <button class="test-button" onclick="testEditRedirect('${doctor.id}', '${doctor.nome}')">
                            üîß Testar Edi√ß√£o de ${doctor.nome.split(' ')[1] || doctor.nome}
                        </button>
                    </div>
                `).join('')}
            `;
        }

        function testEditRedirect(doctorId, doctorName) {
            console.log('üîß Testando redirecionamento para:', doctorName, 'ID:', doctorId);
            
            // Esta √© exatamente a mesma l√≥gica da fun√ß√£o editDoctor da lista-medicos.html
            if (!doctorId) {
                alert('Erro: ID do m√©dico n√£o encontrado');
                return;
            }
            
            const url = `/editar-medico.html?id=${doctorId}`;
            console.log('üåê URL de destino:', url);
            
            // Mostrar no iframe primeiro para teste
            const iframe = document.getElementById('testFrame');
            iframe.style.display = 'block';
            iframe.src = url;
            
            // Tamb√©m redirecionar a p√°gina principal ap√≥s 2 segundos
            setTimeout(() => {
                if (confirm(`Deseja abrir a p√°gina de edi√ß√£o para ${doctorName}?`)) {
                    window.location.href = url;
                }
            }, 2000);
        }

        // Carregar automaticamente quando a p√°gina abrir
        window.addEventListener('load', function() {
            setTimeout(loadDoctorsList, 1000);
        });
    </script>
</body>
</html>