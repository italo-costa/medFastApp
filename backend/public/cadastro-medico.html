<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro de Médico - MediApp</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
            max-width: 900px;
            width: 100%;
            animation: slideUp 0.6s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .header {
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .form-container {
            padding: 40px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .form-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            border: 1px solid #e9ecef;
        }

        .section-title {
            color: #2c3e50;
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #2c3e50;
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 0.95rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-group.required label::after {
            content: " *";
            color: #e74c3c;
        }

        .form-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 15px;
        }

        .form-row-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }

        .address-section {
            grid-column: 1 / -1;
        }

        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 150px;
            justify-content: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .alert {
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .navigation {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            border-radius: 50px;
            padding: 12px 20px;
            color: #2c3e50;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .nav-btn:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        @media (max-width: 768px) {
            .form-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .form-row,
            .form-row-3 {
                grid-template-columns: 1fr;
            }

            .container {
                margin: 10px;
            }

            .form-container {
                padding: 20px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .buttons {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <div class="navigation">
        <button class="nav-btn" id="voltar-dashboard">
            <i class="fas fa-arrow-left"></i>
            Voltar ao Dashboard
        </button>
    </div>

    <div class="container">
        <div class="header">
            <h1><i class="fas fa-user-md"></i> Cadastro de Médico</h1>
            <p>Preencha os dados para criar um novo perfil médico no sistema</p>
        </div>

        <div class="form-container">
            <div id="alert" class="alert"></div>

            <form id="medicoForm">
                <div class="form-grid">
                    <!-- Dados Pessoais -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-user"></i>
                            Dados Pessoais
                        </h3>

                        <div class="form-group required">
                            <label for="nomeCompleto">Nome Completo</label>
                            <input type="text" id="nomeCompleto" name="nomeCompleto" required>
                        </div>

                        <div class="form-row">
                            <div class="form-group required">
                                <label for="cpf">CPF</label>
                                <input type="text" id="cpf" name="cpf" placeholder="000.000.000-00" required>
                            </div>
                            <div class="form-group required">
                                <label for="rg">RG</label>
                                <input type="text" id="rg" name="rg" required>
                            </div>
                        </div>

                        <div class="form-group required">
                            <label for="dataNascimento">Data de Nascimento</label>
                            <input type="date" id="dataNascimento" name="dataNascimento" required>
                        </div>

                        <div class="form-row">
                            <div class="form-group required">
                                <label for="telefone">Telefone</label>
                                <input type="tel" id="telefone" name="telefone" placeholder="(11) 99999-9999" required>
                            </div>
                            <div class="form-group required">
                                <label for="email">Email</label>
                                <input type="email" id="email" name="email" required>
                            </div>
                        </div>
                    </div>

                    <!-- Dados Profissionais -->
                    <div class="form-section">
                        <h3 class="section-title">
                            <i class="fas fa-stethoscope"></i>
                            Dados Profissionais
                        </h3>

                        <div class="form-group required">
                            <label for="crm">CRM (Conselho Regional de Medicina)</label>
                            <input type="text" id="crm" name="crm" placeholder="CRM/SP 123456" required>
                        </div>

                        <div class="form-group required">
                            <label for="especialidade">Especialidade Médica</label>
                            <select id="especialidade" name="especialidade" required>
                                <option value="">Selecione a especialidade</option>
                                <option value="cardiologia">Cardiologia</option>
                                <option value="dermatologia">Dermatologia</option>
                                <option value="endocrinologia">Endocrinologia</option>
                                <option value="gastroenterologia">Gastroenterologia</option>
                                <option value="ginecologia">Ginecologia e Obstetrícia</option>
                                <option value="neurologia">Neurologia</option>
                                <option value="oftalmologia">Oftalmologia</option>
                                <option value="ortopedia">Ortopedia</option>
                                <option value="pediatria">Pediatria</option>
                                <option value="psiquiatria">Psiquiatria</option>
                                <option value="urologia">Urologia</option>
                                <option value="clinica-medica">Clínica Médica</option>
                                <option value="cirurgia-geral">Cirurgia Geral</option>
                                <option value="outras">Outras</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="rqe">RQE (Registro de Qualificação de Especialista)</label>
                            <input type="text" id="rqe" name="rqe" placeholder="Opcional">
                        </div>

                        <div class="form-group required">
                            <label for="instituicaoFormacao">Instituição de Formação</label>
                            <input type="text" id="instituicaoFormacao" name="instituicaoFormacao" required>
                        </div>

                        <div class="form-group required">
                            <label for="anoFormacao">Ano de Formação</label>
                            <input type="number" id="anoFormacao" name="anoFormacao" min="1950" max="2030" required>
                        </div>
                    </div>
                </div>

                <!-- Endereço (seção completa) -->
                <div class="form-section address-section">
                    <h3 class="section-title">
                        <i class="fas fa-map-marker-alt"></i>
                        Endereço
                    </h3>

                    <div class="form-row">
                        <div class="form-group required">
                            <label for="cep">CEP</label>
                            <input type="text" id="cep" name="cep" placeholder="00000-000" required>
                        </div>
                        <div class="form-group">
                            <button type="button" class="btn btn-secondary" data-action="buscar-cep" style="margin-top: 28px;">
                                <i class="fas fa-search"></i>
                                Buscar CEP
                            </button>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group required">
                            <label for="logradouro">Logradouro</label>
                            <input type="text" id="logradouro" name="logradouro" required>
                        </div>
                        <div class="form-group required">
                            <label for="numero">Número</label>
                            <input type="text" id="numero" name="numero" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="complemento">Complemento</label>
                            <input type="text" id="complemento" name="complemento" placeholder="Apto, Sala, etc.">
                        </div>
                        <div class="form-group required">
                            <label for="bairro">Bairro</label>
                            <input type="text" id="bairro" name="bairro" required>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group required">
                            <label for="cidade">Cidade</label>
                            <input type="text" id="cidade" name="cidade" required>
                        </div>
                        <div class="form-group required">
                            <label for="estado">Estado</label>
                            <select id="estado" name="estado" required>
                                <option value="">Selecione o estado</option>
                                <option value="AC">Acre</option>
                                <option value="AL">Alagoas</option>
                                <option value="AP">Amapá</option>
                                <option value="AM">Amazonas</option>
                                <option value="BA">Bahia</option>
                                <option value="CE">Ceará</option>
                                <option value="DF">Distrito Federal</option>
                                <option value="ES">Espírito Santo</option>
                                <option value="GO">Goiás</option>
                                <option value="MA">Maranhão</option>
                                <option value="MT">Mato Grosso</option>
                                <option value="MS">Mato Grosso do Sul</option>
                                <option value="MG">Minas Gerais</option>
                                <option value="PA">Pará</option>
                                <option value="PB">Paraíba</option>
                                <option value="PR">Paraná</option>
                                <option value="PE">Pernambuco</option>
                                <option value="PI">Piauí</option>
                                <option value="RJ">Rio de Janeiro</option>
                                <option value="RN">Rio Grande do Norte</option>
                                <option value="RS">Rio Grande do Sul</option>
                                <option value="RO">Rondônia</option>
                                <option value="RR">Roraima</option>
                                <option value="SC">Santa Catarina</option>
                                <option value="SP">São Paulo</option>
                                <option value="SE">Sergipe</option>
                                <option value="TO">Tocantins</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Dados de Acesso -->
                <div class="form-section address-section">
                    <h3 class="section-title">
                        <i class="fas fa-key"></i>
                        Dados de Acesso
                    </h3>

                    <div class="form-row">
                        <div class="form-group required">
                            <label for="usuario">Usuário/Login</label>
                            <input type="text" id="usuario" name="usuario" required>
                        </div>
                        <div class="form-group">
                            <button type="button" class="btn btn-secondary" data-action="verificar-usuario" style="margin-top: 28px;">
                                <i class="fas fa-check"></i>
                                Verificar
                            </button>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group required">
                            <label for="senha">Senha</label>
                            <input type="password" id="senha" name="senha" required>
                        </div>
                        <div class="form-group required">
                            <label for="confirmarSenha">Confirmar Senha</label>
                            <input type="password" id="confirmarSenha" name="confirmarSenha" required>
                        </div>
                    </div>
                </div>

                <div class="buttons">
                    <button type="button" class="btn btn-secondary" data-action="limpar-formulario">
                        <i class="fas fa-eraser"></i>
                        Limpar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i>
                        Cadastrar Médico
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // Máscaras para campos
        document.getElementById('cpf').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d)/, '$1.$2');
            value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            e.target.value = value;
        });

        document.getElementById('telefone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/(\d{2})(\d)/, '($1) $2');
            value = value.replace(/(\d{5})(\d)/, '$1-$2');
            e.target.value = value;
        });

        document.getElementById('cep').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/(\d{5})(\d)/, '$1-$2');
            e.target.value = value;
        });

        // Buscar CEP via API
        async function buscarCEP() {
            const cep = document.getElementById('cep').value.replace(/\D/g, '');
            if (cep.length !== 8) {
                showAlert('Por favor, digite um CEP válido com 8 dígitos.', 'error');
                return;
            }

            try {
                const response = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
                const data = await response.json();

                if (data.erro) {
                    showAlert('CEP não encontrado.', 'error');
                    return;
                }

                document.getElementById('logradouro').value = data.logradouro;
                document.getElementById('bairro').value = data.bairro;
                document.getElementById('cidade').value = data.localidade;
                document.getElementById('estado').value = data.uf;

                showAlert('Endereço preenchido automaticamente!', 'success');
            } catch (error) {
                showAlert('Erro ao buscar CEP. Tente novamente.', 'error');
            }
        }

        // Verificar disponibilidade do usuário
        async function verificarUsuario() {
            const usuario = document.getElementById('usuario').value;
            if (!usuario) {
                showAlert('Digite um nome de usuário primeiro.', 'error');
                return;
            }

            try {
                const response = await fetch(`/api/auth/check-username`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username: usuario })
                });

                const data = await response.json();
                
                if (data.available) {
                    showAlert('Nome de usuário disponível!', 'success');
                } else {
                    showAlert('Nome de usuário já está em uso.', 'error');
                }
            } catch (error) {
                showAlert('Erro ao verificar usuário. Tente novamente.', 'error');
            }
        }

        // Submissão do formulário
        document.getElementById('medicoForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            // Validar senhas
            const senha = document.getElementById('senha').value;
            const confirmarSenha = document.getElementById('confirmarSenha').value;

            if (senha !== confirmarSenha) {
                showAlert('As senhas não coincidem.', 'error');
                return;
            }

            if (senha.length < 6) {
                showAlert('A senha deve ter pelo menos 6 caracteres.', 'error');
                return;
            }

            // Coletar dados do formulário
            const formData = new FormData(this);
            const dados = Object.fromEntries(formData.entries());

            try {
                const response = await fetch('/api/auth/register-doctor', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(dados)
                });

                const result = await response.json();

                if (response.ok) {
                    showAlert('Médico cadastrado com sucesso!', 'success');
                    setTimeout(() => {
                        window.location.href = '/app.html';
                    }, 2000);
                } else {
                    showAlert(result.message || 'Erro ao cadastrar médico.', 'error');
                }
            } catch (error) {
                showAlert('Erro ao cadastrar médico. Tente novamente.', 'error');
            }
        });

        // Limpar formulário
        function limparFormulario() {
            if (confirm('Tem certeza que deseja limpar todos os campos?')) {
                document.getElementById('medicoForm').reset();
                showAlert('Formulário limpo.', 'success');
            }
        }

        // Mostrar alertas
        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alert.style.display = 'block';
            
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }

        // Validação em tempo real
        document.getElementById('confirmarSenha').addEventListener('input', function() {
            const senha = document.getElementById('senha').value;
            const confirmarSenha = this.value;
            
            if (confirmarSenha && senha !== confirmarSenha) {
                this.style.borderColor = '#e74c3c';
            } else {
                this.style.borderColor = '#e9ecef';
            }
        });

        // Event listener para botão de voltar ao dashboard
        document.getElementById('voltar-dashboard').addEventListener('click', function() {
            window.location.href = '/app.html';
        });

        // Initialize Event Listeners for CSP compliance
        function initializeEventListeners() {
            // Buscar CEP
            document.querySelectorAll('[data-action="buscar-cep"]').forEach(btn => {
                btn.addEventListener('click', buscarCEP);
            });

            // Verificar usuário
            document.querySelectorAll('[data-action="verificar-usuario"]').forEach(btn => {
                btn.addEventListener('click', verificarUsuario);
            });

            // Limpar formulário
            document.querySelectorAll('[data-action="limpar-formulario"]').forEach(btn => {
                btn.addEventListener('click', limparFormulario);
            });
        }

        // Inicializar quando a página carregar
        document.addEventListener('DOMContentLoaded', initializeEventListeners);
    </script>
</body>
</html>