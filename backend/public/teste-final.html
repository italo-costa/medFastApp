<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚úÖ Teste Final - Bot√µes Funcionais</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            padding: 2rem; 
            background: #f5f5f5;
        }
        .container { 
            max-width: 600px; 
            margin: 0 auto; 
            background: white; 
            padding: 2rem; 
            border-radius: 0.5rem; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .doctor-card { 
            border: 1px solid #ddd; 
            padding: 1rem; 
            margin: 1rem 0; 
            border-radius: 0.5rem; 
            background: #fafafa;
        }
        .doctor-actions { 
            margin-top: 1rem; 
        }
        .btn { 
            background: #007bff; 
            color: white; 
            padding: 0.5rem 1rem; 
            border: none; 
            border-radius: 0.25rem; 
            cursor: pointer; 
            margin-right: 0.5rem;
            font-size: 0.9rem;
        }
        .btn:hover { 
            background: #0056b3; 
        }
        .btn-secondary { 
            background: #6c757d; 
        }
        .btn-secondary:hover { 
            background: #545b62; 
        }
        .status { 
            padding: 0.5rem; 
            margin: 1rem 0; 
            border-radius: 0.25rem; 
        }
        .loading { 
            background: #e7f3ff; 
            color: #0066cc; 
        }
        .success { 
            background: #d4edda; 
            color: #155724; 
        }
        .error { 
            background: #f8d7da; 
            color: #721c24; 
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚úÖ Teste Final - Bot√µes de Edi√ß√£o</h1>
        <p>Este √© um teste funcional real dos bot√µes "Editar" que devem redirecionar para a p√°gina de edi√ß√£o.</p>
        
        <div id="status" class="status loading">
            üîÑ Carregando m√©dicos...
        </div>
        
        <div id="doctorsContainer">
            <!-- M√©dicos ser√£o carregados aqui -->
        </div>
        
        <div style="margin-top: 2rem; padding-top: 1rem; border-top: 1px solid #ddd;">
            <h3>üìã Links de Teste Direto</h3>
            <p>Use estes links para testar o redirecionamento manualmente:</p>
            <button class="btn" onclick="window.open('/lista-medicos.html', '_blank')">
                üìã Lista Original
            </button>
            <button class="btn" onclick="window.open('/editar-medico.html?id=cmh3slen1000z6a4gsq8j8eun', '_blank')">
                ‚úèÔ∏è Editar Dr. Andr√©
            </button>
        </div>
    </div>

    <script>
        // Fun√ß√£o editDoctor id√™ntica √† da lista-medicos.html
        function editDoctor(doctorId) {
            console.log('üîß Fun√ß√£o editDoctor chamada com ID:', doctorId);
            
            if (!doctorId) {
                console.error('‚ùå ID do m√©dico n√£o fornecido');
                alert('Erro: ID do m√©dico n√£o encontrado');
                return;
            }
            
            // Mostrar feedback visual
            console.log('üîÑ Redirecionando para edi√ß√£o...');
            
            // Redirecionar para p√°gina de edi√ß√£o com o ID do m√©dico
            const url = `/editar-medico.html?id=${doctorId}`;
            console.log('üåê URL de destino:', url);
            
            // TESTE: Mostrar confirma√ß√£o antes de redirecionar
            if (confirm(`üîß Redirecionar para edi√ß√£o?\\n\\nURL: ${url}`)) {
                window.location.href = url;
            }
        }

        // Fun√ß√£o para carregar m√©dicos
        async function loadDoctors() {
            try {
                const response = await fetch('/api/medicos');
                const data = await response.json();
                
                if (data.success && data.data.length > 0) {
                    document.getElementById('status').innerHTML = `
                        <div class="success">‚úÖ ${data.data.length} m√©dicos carregados com sucesso!</div>
                    `;
                    
                    // Mostrar os primeiros 3 m√©dicos
                    const doctors = data.data.slice(0, 3);
                    const container = document.getElementById('doctorsContainer');
                    
                    container.innerHTML = doctors.map(doctor => `
                        <div class="doctor-card">
                            <h4>${doctor.nome}</h4>
                            <p><strong>Especialidade:</strong> ${doctor.especialidade}</p>
                            <p><strong>CRM:</strong> ${doctor.crm}/${doctor.crm_uf}</p>
                            <p><strong>ID:</strong> <code>${doctor.id}</code></p>
                            
                            <div class="doctor-actions">
                                <button class="btn btn-secondary" onclick="editDoctor('${doctor.id}')" title="Editar dados do m√©dico">
                                    üîß Editar ${doctor.nome.split(' ')[1] || 'M√©dico'}
                                </button>
                                <button class="btn" onclick="window.open('/detalhes-medico.html?id=${doctor.id}', '_blank')">
                                    üëÅÔ∏è Ver Detalhes
                                </button>
                            </div>
                        </div>
                    `).join('');
                    
                    console.log('‚úÖ Bot√µes criados para', doctors.length, 'm√©dicos');
                } else {
                    throw new Error('Nenhum m√©dico encontrado');
                }
            } catch (error) {
                document.getElementById('status').innerHTML = `
                    <div class="error">‚ùå Erro: ${error.message}</div>
                `;
                console.error('Erro ao carregar m√©dicos:', error);
            }
        }

        // Carregar quando a p√°gina estiver pronta
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ P√°gina de teste carregada');
            loadDoctors();
        });
    </script>
</body>
</html>